- pipeline: "Build and deploy"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "master"
  ref_type: "BRANCH"
  priority: "NORMAL"
  fail_on_prepare_env_warning: true
  trigger_condition: "ALWAYS"
  actions:
  - action: "Build Project"
    type: "BUILD"
    working_directory: "/buddy/draft-theme"
    docker_image_name: "library/node:14"
    docker_image_tag: "latest"
    execute_commands:
    - "npm install"
    - "npm uninstall --save-dev node-sass"
    - "npm install --save-dev node-sass"
    - "npm run build"
    setup_commands:
    - "curl -s https://raw.githubusercontent.com/Shopify/themekit/master/scripts/install.py |  python"
    - ""
    volume_mappings:
    - "/:/buddy/draft-theme"
    trigger_condition: "ALWAYS"
    shell: "BASH"
  - action: "Deploy Theme"
    type: "SHOPIFY_THEMEKIT_CLI"
    execute_commands:
    - "cd ./src"
    - "theme deploy --themeid=$theme_id --password=$password --store=$store"
    trigger_condition: "ALWAYS"
    shell: "SH"
    integration_hash: "o2j50r4KGRb4V8q1eBLZQxgy91"
  variables:
  - key: "theme_id"
    value: "120160387204"
  - key: "password"
    value: "719afdef513ebf85ea1843c7285402ca"
  - key: "store"
    value: "https://draft-theme.myshopify.com/"
