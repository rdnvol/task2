{% comment %}
  QR code is rendered in `#QrCode`

  `gift_card.pass_url` is true if apple wallet is enabled for the shop
{% endcomment %}

{% layout 'gift_card' %}

<header>
  <div class="logo text-center">
    <a href="{{ routes.root_url }}" rel="nofollow">
      <img src="{{ section.settings.logo_svg | asset_url }}" width="86" height="18" alt="Draft logotype">
    </a>
  </div>
</header>

<div class="giftcard {% if gift_card.expired or gift_card.enabled != true %} giftcard--disabled{% endif %}">
  <div class="container">
    <div class="md:w-9/12 md:mx-auto text-center">
      <h1 class="h5 mb-5">{{ 'gift_cards.issued.subtext' | t }}</h1>
      {% unless gift_card.enabled %}
        <span class="giftcard-tag">{{ 'gift_cards.issued.disabled' | t }}</span>
      {% endunless %}

      {%- assign gift_card_expiry_date = gift_card.expires_on | date: "%d/%m/%y" -%}

      {% if gift_card.expired and gift_card.enabled %}
        <span class="giftcard-tag">{{ 'gift_cards.issued.expired' | t: expiry: gift_card_expiry_date }}</span>
      {% endif %}

      {% if gift_card.expired != true and gift_card.expires_on and gift_card.enabled %}
        <span class="giftcard-tag giftcard-tag--active">
          {{- 'gift_cards.issued.active' | t: expiry: gift_card_expiry_date -}}
        </span>
      {% endif %}

      {% assign formatted_initial_value = gift_card.initial_value | money_without_trailing_zeros: gift_card.currency %}

      <div class="product-price-large mb-4">
        {{ 'gift_cards.issued.initial_value' | t: value: formatted_initial_value }}
      </div>

      {% assign formatted_current_balance = gift_card.balance | money %}

      {% if gift_card.balance != gift_card.initial_value %}
        <p>{{ 'gift_cards.issued.remaining_html' | t: balance: formatted_current_balance }}</p>
      {% endif %}

      <div class="gift-card__image-wrapper mb-5 relative ">
        <img src="{{ 'gift-card/card.jpg' | shopify_asset_url }}" alt="Gift card illustration">

        <div class="gift-card__qr-code mt-5">
          <canvas
            id="QrCode"
            class="giftcard-qr"
            data-identifier="{{ gift_card.qr_identifier }}"
            data-gift-card-qr
          ></canvas>
          <div>
            {%
              render 'image',
              asset_img_url: true,
              src: 'img-placeholder.png',
              d: '120x120',
              placeholder: 'img-placeholder.png',
            %}
          </div>
        </div>
      </div>

      <div id="GiftCardDigits" class="mb-3" data-gift-card-digits>
        <input
          type="text"
          class="gift-card__number text-center"
          value="{{ gift_card.code | format_code }}"
          aria-label="{{ 'gift_cards.issued.gift_card_code' | t }}"
          readonly
        >
      </div>

      <div class="mb-5">
        <button class="button default gift-card__copy-link link">Copy code</button>
      </div>
      {% if gift_card.pass_url %}
        <a href="{{ gift_card.pass_url }}" class="apple-wallet">
          <img
            class="apple-wallet-image"
            src="{{ 'gift-card/add-to-apple-wallet.svg' | shopify_asset_url }}"
            width="120"
            height="40"
            alt="{{ 'gift_cards.issued.add_to_apple_wallet' | t }}"
          >
        </a>
      {% endif %}
      <div class="mb-5">
        <a href="{{ routes.root_url }}" rel="nofollow" class="button button--secondary" target="_blank">
          {{- 'gift_cards.issued.shop_link' | t -}}
        </a>
      </div>

      <button id="PrintGiftCard" class="button" data-gift-card-print>
        {{ 'gift_cards.issued.print' | t }}
      </button>
    </div>
  </div>
</div>
